<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Core/AppClient.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AppClient.html">AppClient</a><ul class='methods'><li data-type='method'><a href="AppClient.html#emit">emit</a></li><li data-type='method'><a href="AppClient.html#getProperty">getProperty</a></li><li data-type='method'><a href="AppClient.html#off">off</a></li><li data-type='method'><a href="AppClient.html#once">once</a></li><li data-type='method'><a href="AppClient.html#refresh">refresh</a></li><li data-type='method'><a href="AppClient.html#subscribe">subscribe</a></li><li data-type='method'><a href="AppClient.html#t">t</a></li></ul></li><li><a href="AppEventEmitter.html">AppEventEmitter</a><ul class='methods'><li data-type='method'><a href="AppEventEmitter.html#emitAsync">emitAsync</a></li><li data-type='method'><a href="AppEventEmitter.html#emitCancelable">emitCancelable</a></li><li data-type='method'><a href="AppEventEmitter.html#emitInvokeAsync">emitInvokeAsync</a></li><li data-type='method'><a href="AppEventEmitter.html#onInvoke">onInvoke</a></li></ul></li><li><a href="Context.html">Context</a><ul class='methods'><li data-type='method'><a href="Context.html#_getTabData">_getTabData</a></li><li data-type='method'><a href="Context.html#available">available</a></li><li data-type='method'><a href="Context.html#get">get</a></li><li data-type='method'><a href="Context.html#getMe">getMe</a></li><li data-type='method'><a href="Context.html#getProperty">getProperty</a></li><li data-type='method'><a href="Context.html#hasProperty">hasProperty</a></li><li data-type='method'><a href="Context.html#toJS">toJS</a></li></ul></li><li><a href="ContextFactory.html">ContextFactory</a><ul class='methods'><li data-type='method'><a href="ContextFactory.html#.contextObjectTypes">contextObjectTypes</a></li><li data-type='method'><a href="ContextFactory.html#.create">create</a></li></ul></li><li><a href="ContextHostUI.html">ContextHostUI</a></li><li><a href="ContextHostUITab.html">ContextHostUITab</a><ul class='methods'><li data-type='method'><a href="ContextHostUITab.html#activateTab">activateTab</a></li><li data-type='method'><a href="ContextHostUITab.html#closeTab">closeTab</a></li><li data-type='method'><a href="ContextHostUITab.html#isTabActive">isTabActive</a></li></ul></li><li><a href="ContextObject.html">ContextObject</a><ul class='methods'><li data-type='method'><a href="ContextObject.html#get">get</a></li><li data-type='method'><a href="ContextObject.html#getCustomField">getCustomField</a></li></ul></li><li><a href="ContextProps.html">ContextProps</a><ul class='methods'><li data-type='method'><a href="ContextProps.html#getProperty">getProperty</a></li><li data-type='method'><a href="ContextProps.html#toJS">toJS</a></li><li data-type='method'><a href="ContextProps.html#toJSON">toJSON</a></li></ul></li><li><a href="CustomFieldsClient.html">CustomFieldsClient</a><ul class='methods'><li data-type='method'><a href="CustomFieldsClient.html#getAppField">getAppField</a></li><li data-type='method'><a href="CustomFieldsClient.html#getField">getField</a></li><li data-type='method'><a href="CustomFieldsClient.html#setAppField">setAppField</a></li><li data-type='method'><a href="CustomFieldsClient.html#setField">setField</a></li></ul></li><li><a href="DeskproAPIClient.html">DeskproAPIClient</a><ul class='methods'><li data-type='method'><a href="DeskproAPIClient.html#del">del</a></li><li data-type='method'><a href="DeskproAPIClient.html#delete">delete</a></li><li data-type='method'><a href="DeskproAPIClient.html#fetch">fetch</a></li><li data-type='method'><a href="DeskproAPIClient.html#fetchProxy">fetchProxy</a></li><li data-type='method'><a href="DeskproAPIClient.html#get">get</a></li><li data-type='method'><a href="DeskproAPIClient.html#post">post</a></li><li data-type='method'><a href="DeskproAPIClient.html#put">put</a></li></ul></li><li><a href="DeskproWindowFacade.html">DeskproWindowFacade</a><ul class='methods'><li data-type='method'><a href="DeskproWindowFacade.html#domInsert">domInsert</a></li><li data-type='method'><a href="DeskproWindowFacade.html#domQuery">domQuery</a></li><li data-type='method'><a href="DeskproWindowFacade.html#showNotification">showNotification</a></li></ul></li><li><a href="EventMap.html">EventMap</a><ul class='methods'><li data-type='method'><a href="EventMap.html#getEventKey">getEventKey</a></li><li data-type='method'><a href="EventMap.html#getEventProps">getEventProps</a></li><li data-type='method'><a href="EventMap.html#isEventName">isEventName</a></li></ul></li><li><a href="FetchStorageAdapter.html">FetchStorageAdapter</a><ul class='methods'><li data-type='method'><a href="FetchStorageAdapter.html#handleGetBatchStorage">handleGetBatchStorage</a></li><li data-type='method'><a href="FetchStorageAdapter.html#handleGetStorage">handleGetStorage</a></li><li data-type='method'><a href="FetchStorageAdapter.html#handleSetBatchStorage">handleSetBatchStorage</a></li><li data-type='method'><a href="FetchStorageAdapter.html#handleSetStorage">handleSetStorage</a></li></ul></li><li><a href="InitPropertiesBag.html">InitPropertiesBag</a><ul class='methods'><li data-type='method'><a href="InitPropertiesBag.html#.fromQueryString">fromQueryString</a></li><li data-type='method'><a href="InitPropertiesBag.html#.fromWindow">fromWindow</a></li><li data-type='method'><a href="InitPropertiesBag.html#.validate">validate</a></li><li data-type='method'><a href="InitPropertiesBag.html#toQueryString">toQueryString</a></li></ul></li><li><a href="InstanceProps.html">InstanceProps</a><ul class='methods'><li data-type='method'><a href="InstanceProps.html#getProperty">getProperty</a></li><li data-type='method'><a href="InstanceProps.html#toJS">toJS</a></li><li data-type='method'><a href="InstanceProps.html#toJSON">toJSON</a></li></ul></li><li><a href="LocalStorageAdapter.html">LocalStorageAdapter</a><ul class='methods'><li data-type='method'><a href="LocalStorageAdapter.html#.fromGlobals">fromGlobals</a></li><li data-type='method'><a href="LocalStorageAdapter.html#handleGetBatchStorage">handleGetBatchStorage</a></li><li data-type='method'><a href="LocalStorageAdapter.html#handleGetStorage">handleGetStorage</a></li><li data-type='method'><a href="LocalStorageAdapter.html#handleSetBatchStorage">handleSetBatchStorage</a></li><li data-type='method'><a href="LocalStorageAdapter.html#handleSetStorage">handleSetStorage</a></li></ul></li><li><a href="module-Core_EventHandler-EventHandler.html">EventHandler</a><ul class='methods'><li data-type='method'><a href="module-Core_EventHandler-EventHandler.html#.handleIncomingEvent">handleIncomingEvent</a></li><li data-type='method'><a href="module-Core_EventHandler-EventHandler.html#.handleOutgoingEvent">handleOutgoingEvent</a></li></ul></li><li><a href="module-Core_Event-Event.html">Event</a></li><li><a href="OauthConnection.html">OauthConnection</a><ul class='methods'><li data-type='method'><a href="OauthConnection.html#.fromJS">fromJS</a></li></ul></li><li><a href="OauthFacade.html">OauthFacade</a><ul class='methods'><li data-type='method'><a href="OauthFacade.html#refreshAccess">refreshAccess</a></li><li data-type='method'><a href="OauthFacade.html#register">register</a></li><li data-type='method'><a href="OauthFacade.html#requestAccess">requestAccess</a></li><li data-type='method'><a href="OauthFacade.html#settings">settings</a></li></ul></li><li><a href="global.html#OauthToken">OauthToken</a><ul class='methods'><li data-type='method'><a href="global.html#OauthToken#.fromJS">fromJS</a></li><li data-type='method'><a href="global.html#OauthToken#.fromOauthProxyResponse">fromOauthProxyResponse</a></li></ul></li><li><a href="PropertyBag.html">PropertyBag</a><ul class='methods'><li data-type='method'><a href="PropertyBag.html#getProperty">getProperty</a></li><li data-type='method'><a href="PropertyBag.html#toJS">toJS</a></li><li data-type='method'><a href="PropertyBag.html#toJSON">toJSON</a></li></ul></li><li><a href="StorageAdapter.html">StorageAdapter</a><ul class='methods'><li data-type='method'><a href="StorageAdapter.html#handleGetBatchStorage">handleGetBatchStorage</a></li><li data-type='method'><a href="StorageAdapter.html#handleGetStorage">handleGetStorage</a></li><li data-type='method'><a href="StorageAdapter.html#handleSetBatchStorage">handleSetBatchStorage</a></li><li data-type='method'><a href="StorageAdapter.html#handleSetStorage">handleSetStorage</a></li></ul></li><li><a href="StorageApiFacade.html">StorageApiFacade</a><ul class='methods'><li data-type='method'><a href="StorageApiFacade.html#getAppStorage">getAppStorage</a></li><li data-type='method'><a href="StorageApiFacade.html#getEntityStorage">getEntityStorage</a></li><li data-type='method'><a href="StorageApiFacade.html#getStorage">getStorage</a></li><li data-type='method'><a href="StorageApiFacade.html#setAppStorage">setAppStorage</a></li><li data-type='method'><a href="StorageApiFacade.html#setEntityStorage">setEntityStorage</a></li><li data-type='method'><a href="StorageApiFacade.html#setStorage">setStorage</a></li></ul></li><li><a href="UIFacade.html">UIFacade</a><ul class='methods'><li data-type='method'><a href="UIFacade.html#collapse">collapse</a></li><li data-type='method'><a href="UIFacade.html#expand">expand</a></li><li data-type='method'><a href="UIFacade.html#fullscreen">fullscreen</a></li><li data-type='method'><a href="UIFacade.html#hide">hide</a></li><li data-type='method'><a href="UIFacade.html#hideBadgeCount">hideBadgeCount</a></li><li data-type='method'><a href="UIFacade.html#hideLoading">hideLoading</a></li><li data-type='method'><a href="UIFacade.html#hideMenu">hideMenu</a></li><li data-type='method'><a href="UIFacade.html#isCollapsed">isCollapsed</a></li><li data-type='method'><a href="UIFacade.html#isError">isError</a></li><li data-type='method'><a href="UIFacade.html#isExpanded">isExpanded</a></li><li data-type='method'><a href="UIFacade.html#isHidden">isHidden</a></li><li data-type='method'><a href="UIFacade.html#isLoading">isLoading</a></li><li data-type='method'><a href="UIFacade.html#isReady">isReady</a></li><li data-type='method'><a href="UIFacade.html#isVisible">isVisible</a></li><li data-type='method'><a href="UIFacade.html#show">show</a></li><li data-type='method'><a href="UIFacade.html#showBadgeCount">showBadgeCount</a></li><li data-type='method'><a href="UIFacade.html#showLoading">showLoading</a></li><li data-type='method'><a href="UIFacade.html#showMenu">showMenu</a></li><li data-type='method'><a href="UIFacade.html#showSettings">showSettings</a></li></ul></li><li><a href="WidgetMessage.html">WidgetMessage</a><ul class='methods'><li data-type='method'><a href="WidgetMessage.html#getProperty">getProperty</a></li><li data-type='method'><a href="WidgetMessage.html#toJS">toJS</a></li><li data-type='method'><a href="WidgetMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="WidgetRequest.html">WidgetRequest</a><ul class='methods'><li data-type='method'><a href="WidgetRequest.html#getProperty">getProperty</a></li><li data-type='method'><a href="WidgetRequest.html#toJS">toJS</a></li><li data-type='method'><a href="WidgetRequest.html#toJSON">toJSON</a></li></ul></li><li><a href="WidgetResponse.html">WidgetResponse</a><ul class='methods'><li data-type='method'><a href="WidgetResponse.html#getProperty">getProperty</a></li><li data-type='method'><a href="WidgetResponse.html#toJS">toJS</a></li><li data-type='method'><a href="WidgetResponse.html#toJSON">toJSON</a></li></ul></li><li><a href="WidgetWindowBridge.html">WidgetWindowBridge</a><ul class='methods'><li data-type='method'><a href="WidgetWindowBridge.html#connect">connect</a></li><li data-type='method'><a href="WidgetWindowBridge.html#emitRequest">emitRequest</a></li><li data-type='method'><a href="WidgetWindowBridge.html#emitResponse">emitResponse</a></li><li data-type='method'><a href="WidgetWindowBridge.html#on">on</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-Context.html">Context</a><ul class='methods'><li data-type='method'><a href="module-Context.html#.createContext">createContext</a></li><li data-type='method'><a href="module-Context.html#.registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-Context_eventsTicket.html">Context/eventsTicket</a><ul class='methods'><li data-type='method'><a href="module-Context_eventsTicket.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-Context_eventsTicket.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-Context_eventsTicket.html#.isEventName">isEventName</a></li><li data-type='method'><a href="module-Context_eventsTicket.html#.isEventName">isEventName</a></li></ul></li><li><a href="module-Core.html">Core</a></li><li><a href="module-Core_AppEvents.html">Core/AppEvents</a><ul class='methods'><li data-type='method'><a href="module-Core_AppEvents.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-Core_AppEvents.html#.isEventName">isEventName</a></li><li data-type='method'><a href="module-Core_AppEvents.html#.registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-Core_ContextUserEvents.html">Core/ContextUserEvents</a><ul class='methods'><li data-type='method'><a href="module-Core_ContextUserEvents.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-Core_ContextUserEvents.html#.isEventName">isEventName</a></li><li data-type='method'><a href="module-Core_ContextUserEvents.html#.registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-Core_createApp.html">Core/createApp</a><ul class='methods'><li data-type='method'><a href="module-Core_createApp.html#.createApp">createApp</a></li><li data-type='method'><a href="module-Core_createApp.html#.createAppFromProps">createAppFromProps</a></li><li data-type='method'><a href="module-Core_createApp.html#.createMockApp">createMockApp</a></li><li data-type='method'><a href="module-Core_createApp.html#.createRenderer">createRenderer</a></li><li data-type='method'><a href="module-Core_createApp.html#.getDpApp">getDpApp</a></li><li data-type='method'><a href="module-Core_createApp.html#~createAppOnConnection">createAppOnConnection</a></li></ul></li><li><a href="module-Core_emit.html">Core/emit</a><ul class='methods'><li data-type='method'><a href="module-Core_emit.html#.emitAsync">emitAsync</a></li></ul></li><li><a href="module-Core_Event.html">Core/Event</a><ul class='methods'><li data-type='method'><a href="module-Core_Event.html#.buildMap">buildMap</a></li><li data-type='method'><a href="module-Core_Event.html#.matchEvent">matchEvent</a></li><li data-type='method'><a href="module-Core_Event.html#~matchProps">matchProps</a></li></ul></li><li><a href="module-Core_EventHandler.html">Core/EventHandler</a><ul class='methods'><li data-type='method'><a href="module-Core_EventHandler.html#.handleAppEvents">handleAppEvents</a></li><li data-type='method'><a href="module-Core_EventHandler.html#.handleIncomingEvent">handleIncomingEvent</a></li><li data-type='method'><a href="module-Core_EventHandler.html#.handleInvokeEvents">handleInvokeEvents</a></li><li data-type='method'><a href="module-Core_EventHandler.html#.handleOutgoingEvent">handleOutgoingEvent</a></li><li data-type='method'><a href="module-Core_EventHandler.html#~dispatchIncomingEvent">dispatchIncomingEvent</a></li></ul></li><li><a href="module-CustomFields.html">CustomFields</a></li><li><a href="module-DeskproWindow.html">DeskproWindow</a><ul class='methods'><li data-type='method'><a href="module-DeskproWindow.html#.createDeskproWindowFacade">createDeskproWindowFacade</a></li><li data-type='method'><a href="module-DeskproWindow.html#.registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-DeskproWindow_events.html">DeskproWindow/events</a><ul class='methods'><li data-type='method'><a href="module-DeskproWindow_events.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-DeskproWindow_events.html#.isEventName">isEventName</a></li></ul></li><li><a href="module-Security.html">Security</a><ul class='methods'><li data-type='method'><a href="module-Security.html#.createOauthAPIClient">createOauthAPIClient</a></li><li data-type='method'><a href="module-Security.html#.registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-Security_events.html">Security/events</a><ul class='methods'><li data-type='method'><a href="module-Security_events.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-Security_events.html#.isEventName">isEventName</a></li></ul></li><li><a href="module-Storage.html">Storage</a><ul class='methods'><li data-type='method'><a href="module-Storage.html#.createStorageAPIClient">createStorageAPIClient</a></li></ul></li><li><a href="module-UI.html">UI</a><ul class='methods'><li data-type='method'><a href="module-UI.html#.createUIFacade">createUIFacade</a></li><li data-type='method'><a href="module-UI.html#.registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-UI_constants.html">UI/constants</a></li><li><a href="module-UI_events.html">UI/events</a><ul class='methods'><li data-type='method'><a href="module-UI_events.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-UI_events.html#.isEventName">isEventName</a></li></ul></li><li><a href="module-WebAPI.html">WebAPI</a><ul class='methods'><li data-type='method'><a href="module-WebAPI.html#.createDeskproApiClient">createDeskproApiClient</a></li><li data-type='method'><a href="module-WebAPI.html#.registerEventHandlers">registerEventHandlers</a></li><li data-type='method'><a href="module-WebAPI.html#~createDeskproApiClient">createDeskproApiClient</a></li><li data-type='method'><a href="module-WebAPI.html#~registerEventHandlers">registerEventHandlers</a></li></ul></li><li><a href="module-WebAPI_events.html">WebAPI/events</a><ul class='methods'><li data-type='method'><a href="module-WebAPI_events.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-WebAPI_events.html#.isEventName">isEventName</a></li></ul></li><li><a href="module-Widget.html">Widget</a></li><li><a href="module-Widget_events.html">Widget/events</a><ul class='methods'><li data-type='method'><a href="module-Widget_events.html#.getDefinition">getDefinition</a></li><li data-type='method'><a href="module-Widget_events.html#.isEventName">isEventName</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#actionChangePropsAsync">actionChangePropsAsync</a></li><li><a href="global.html#addPhrasePack">addPhrasePack</a></li><li><a href="global.html#addPhrasePacks">addPhrasePacks</a></li><li><a href="global.html#addPhrases">addPhrases</a></li><li><a href="global.html#addScenario">addScenario</a></li><li><a href="global.html#AppEvents">AppEvents</a></li><li><a href="global.html#changeLanguage">changeLanguage</a></li><li><a href="global.html#ContextUserEvents">ContextUserEvents</a></li><li><a href="global.html#createApp">createApp</a></li><li><a href="global.html#createAppFromProps">createAppFromProps</a></li><li><a href="global.html#createDefaultWindowBridge">createDefaultWindowBridge</a></li><li><a href="global.html#createMockApp">createMockApp</a></li><li><a href="global.html#createMockWindowBridge">createMockWindowBridge</a></li><li><a href="global.html#createWindowBridge">createWindowBridge</a></li><li><a href="global.html#DeskproWindowEvents">DeskproWindowEvents</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatDateDistance">formatDateDistance</a></li><li><a href="global.html#formatDateDistanceStrict">formatDateDistanceStrict</a></li><li><a href="global.html#formatNumber">formatNumber</a></li><li><a href="global.html#fromInitProps">fromInitProps</a></li><li><a href="global.html#fromParentWindow">fromParentWindow</a></li><li><a href="global.html#getDpApp">getDpApp</a></li><li><a href="global.html#getEventDefinition">getEventDefinition</a></li><li><a href="global.html#getExactPhrase">getExactPhrase</a></li><li><a href="global.html#getHandlerPayload">getHandlerPayload</a></li><li><a href="global.html#hasExactPhrase">hasExactPhrase</a></li><li><a href="global.html#hasPhrase">hasPhrase</a></li><li><a href="global.html#language">language</a></li><li><a href="global.html#namespacedTranslate">namespacedTranslate</a></li><li><a href="global.html#nextRequest">nextRequest</a></li><li><a href="global.html#nextResponse">nextResponse</a></li><li><a href="global.html#parseRequest">parseRequest</a></li><li><a href="global.html#parseResponse">parseResponse</a></li><li><a href="global.html#parseScenarioInitQueryString">parseScenarioInitQueryString</a></li><li><a href="global.html#parseWidgetMessage">parseWidgetMessage</a></li><li><a href="global.html#propertyProviderTab">propertyProviderTab</a></li><li><a href="global.html#receiveChangeProps">receiveChangeProps</a></li><li><a href="global.html#resolveLanguages">resolveLanguages</a></li><li><a href="global.html#SecurityEvents">SecurityEvents</a></li><li><a href="global.html#setActiveScenario">setActiveScenario</a></li><li><a href="global.html#t">t</a></li><li><a href="global.html#translate">translate</a></li><li><a href="global.html#UIConstants">UIConstants</a></li><li><a href="global.html#UIEvents">UIEvents</a></li><li><a href="global.html#WidgetEvents">WidgetEvents</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Core/AppClient.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as AppEvents from './AppEvents';
import * as Event from './Event';
import NamespacedBrowserStorage from '../Storage/NamespacedBrowserStorage';

/**
 * A facade exposing all the underlying services required by an application
 *
 * @class
 */
class AppClient {
  /**
   *
   * @param {function} registerEventHandlers registers on demand event handlers via the {@link AppClient.subscribe} method
   * @param {AppEventEmitter} outgoingDispatcher the outgoing events dispatcher
   * @param {AppEventEmitter} incomingDispatcher the outgoing events dispatcher
   * @param {AppEventEmitter} localDispatcher the internal events dispatcher
   * @param {InstanceProps} instanceProps the property bag containing instance props
   * @param {ContextProps} contextProps the property bag containing context props
   * @param {Context} context instance of the {@link Context} client
   * @param {DeskproAPIClient} restApi instance of the deskpro api client
   * @param {StorageApiFacade} storageApi instance of the storage api client
   * @param {DeskproWindowFacade} deskproWindow instance of the deskpro window client
   * @param {OauthFacade} oauth instanceof of the oauth client
   * @param {UIFacade} ui instance of the ui client
   * @param {I18nClient} i18n instance of the i18n client
   * @param {boolean} isPreRender flag that indicates the app is running in pre-render mode
   */
  constructor({
    registerEventHandlers,
    outgoingDispatcher,
    incomingDispatcher,
    localDispatcher,
    instanceProps,
    contextProps,
    context,
    restApi,
    storageApi,
    deskproWindow,
    oauth,
    ui,
    i18n,
    isPreRender,
  }) {
    this.props = {
      registerEventHandlers,
      outgoingDispatcher,
      incomingDispatcher,
      localDispatcher,
      instanceProps,
      contextProps,
      context,
      restApi,
      storageApi,
      deskproWindow,
      oauth,
      ui,
      i18n,
      isPreRender: isPreRender || false,
    };

    this._state = {
      appTitle: instanceProps.appTitle,
    };
  }

  // EVENT EMITTER API
  /**
   * Registers an event listener. For the moment, you can only listen to internal events via this method
   *
   * @public
   * @param {String} eventName
   * @param {function} listener
   */
  on = (eventName, listener) => {
    // TODO need to check if eventName is an internal one, for now just assume everyything is
    this.props.localDispatcher.on(eventName, listener);
  };

  /**
   * Removes an event listener. For the moment, only internal events are supported
   *
   * @public
   * @method
   * @param {String} eventName
   * @param {function} listener
   */
  off = (eventName, listener) => {
    // TODO need to check if eventName is an internal one, for now just assume everything is
    this.props.localDispatcher.removeListener(eventName, listener);
  };

  /**
   * Adds a one time event listener for an internal event
   *
   * @public
   * @method
   * @param {String} eventName
   * @param {function} listener
   */
  once = (eventName, listener) => {
    // TODO need to check if eventName is an internal one, for now just assume everything is
    this.props.localDispatcher.once(eventName, listener);
  };

  // EVENT SUBSCRIBER API

  /**
   * Get notified when the app receives an incoming event, such as one sent from the helpdesk window.
   * An example of such an event is the `context.ticket.reply`event which is sent when the agent replies to a ticket
   *
   * @param {string} eventName
   * @param {function(Object):Promise}  handler
   */
  subscribe(eventName, handler) {
    const { outgoingDispatcher, registerEventHandlers } = this.props;

    function sendHandlerResponse(sendResponse, data) {
      let handlerResult;

      try {
        handlerResult = handler(data);
      } catch (e) {
        sendResponse(null, { canceled: false, message: e });
        return;
      }

      const handlerPromise =
        handlerResult instanceof Promise
          ? handlerResult
          : Promise.resolve(handlerResult);

      handlerPromise
        .catch(message => {
          sendResponse(null, { canceled: true, message });
          return Promise.reject(message);
        })
        .then(message => sendResponse(null, { canceled: false, message }));
    }

    outgoingDispatcher
      .emitAsync(AppEvents.EVENT_SUBSCRIBE, { events: [eventName] })
      .then(events => {
        for (const event of events) {
          const eventProps = {
            channelType: Event.CHANNEL_INCOMING,
            invocationType: event.invocationType,
          };
          registerEventHandlers(this, event.name, eventProps);
          this.props.incomingDispatcher.on(event.name, sendHandlerResponse);
        }
      });
  }

  /**
   * Triggers the listeners of an outgoing or internal event
   *
   * @public
   * @method
   * @param {string|{}} event
   * @param {...*} args
   * @return {Promise.&lt;*>}
   */
  async emit(event, ...args) {
    // invocation
    if (Event.isInvocation(event) &amp;&amp; args.length > 0) {
      const { outgoingDispatcher } = this.props;
      return outgoingDispatcher.emitInvokeAsync({ ...event, data: args[0] });
    }

    // internal event
    const { localDispatcher } = this.props;
    const dispatcherArgs = [event].concat(args);
    localDispatcher.emit.apply(localDispatcher, dispatcherArgs);
    return Promise.resolve(args);
  }

  // Properties API

  /**
   * Returns the value of a property by looking up in the instance properties bag then in the context properties bag
   *
   * @public
   * @method
   * @param {String} propertyName
   * @return {String|null|undefined}
   */
  getProperty = propertyName => {
    const { instanceProps, contextProps } = this.props;
    let value = instanceProps.getProperty(propertyName);

    if (value === undefined) {
      value = contextProps.getProperty(propertyName);
    }

    if (value === undefined) {
      const otherProps = ['isPreRender'];
      if (-1 !== otherProps.indexOf(propertyName)) {
        value = this.props[propertyName];
      }
    }

    return value;
  };

  /**
   * Returns a map of all the instance and context properties
   *
   * @public
   * @return {Object}
   */
  get properties() {
    const { instanceProps, contextProps, isPreRender } = this.props;

    const instanceProperties = instanceProps.toJS();
    const contextProperties = contextProps.toJS();

    return { ...instanceProperties, ...contextProperties, isPreRender };
  }

  /**
   * Returns th UUID of the helpdesk.
   *
   * @return {string}
   */
  get helpdeskUuid() {
    return this.props.contextProps.getProperty('appsHelpdeskUuid');
  }

  /**
   * Returns the name of the current application environment
   *
   * @public
   * @return {'production'|'development'}
   */
  get environment() {
    const defaultEnvironment = 'production';

    const { contextProps } = this.props;
    const env = contextProps.getProperty('appsEnvironment');
    return env || defaultEnvironment;
  }

  /**
   * The id of the application this instance belongs to
   *
   * @public
   * @readonly
   * @return {String}
   */
  get appId() {
    return this.props.instanceProps.appId;
  }

  /**
   * The id of this instance
   *
   * @public
   * @readonly
   * @return {String}
   */
  get instanceId() {
    return this.props.instanceProps.instanceId;
  }

  /**
   * The display title of this application
   *
   * @public
   * @return {String}
   */
  get appTitle() {
    return this.props.instanceProps.appTitle;
  }

  /**
   * The package name (from package.json) of this application
   *
   * @public
   * @readonly
   * @type {String}
   */
  get packageName() {
    return this.props.instanceProps.appPackageName;
  }

  // Misc API

  /**
   * Emits an internal event that signals its handlers the application needs to refresh. When the application has
   * an UI then it will re-render
   *
   * @public
   * @method
   */
  refresh = () => {
    if (
      window &amp;&amp;
      window.location &amp;&amp;
      typeof window.location.reload === 'function'
    ) {
      window.location.reload(true);
    }
  };

  // CLIENTS

  /**
   * The oauth client
   *
   * @public
   * @readonly
   * @type {OauthFacade}
   */
  get oauth() {
    return this.props.oauth;
  }

  /**
   * The UI client of the application, which provides a standard way to invoke UI behaviour
   *
   * @public
   * @readonly
   * @type {UIFacade}
   */
  get ui() {
    return this.props.ui;
  }

  /**
   * The help desk UI client, which enables interaction with the UI of the helpdesk window hosting the application
   *
   * @public
   * @readonly
   * @type {DeskproWindowFacade}
   */
  get deskproWindow() {
    return this.props.deskproWindow;
  }

  /**
   * A client for the Deskpro REST API
   *
   * @public
   * @readonly
   * @type {DeskproAPIClient}
   */
  get restApi() {
    return this.props.restApi;
  }

  /**
   * A client for accessing the storage APIs in a simple manner
   *
   * @public
   * @readonly
   * @type {StorageApiFacade}
   */
  get storage() {
    return this.props.storageApi;
  }

  /**
   * A wrapper around the normal browser localStorage. Use this
   * instead of the actual browser localStorage to avoid key conflicts
   * with other apps.
   *
   * @see https://developer.mozilla.org/en-US/docs/Web/API/Storage
   * @type {Storage}
   */
  get localStorage() {
    if (!this._localStorage) {
      this._localStorage = NamespacedBrowserStorage.createLocalStorage(
        this.helpdeskUuid + ':' + this.appId,
      );
    }

    return this._localStorage;
  }

  /**
   * A wrapper around the normal browser sessionStorage. Use this
   * instead of the actual browser sessionStorage to avoid key conflicts
   * with other apps.
   *
   * @see https://developer.mozilla.org/en-US/docs/Web/API/Storage
   * @type {Storage}
   */
  get sessionStorage() {
    if (!this._sessionStorage) {
      this._sessionStorage = NamespacedBrowserStorage.createSessionStorage(
        this.helpdeskUuid + ':' + this.appId,
      );
    }

    return this._sessionStorage;
  }

  /**
   * Get the i18n client.
   *
   * @return {I18nClient}
   */
  get i18n() {
    return this.props.i18n;
  }

  /**
   * Alias for i18n.t()
   *
   * @param keys
   * @param vars
   */
  t(keys, vars) {
    return this.props.i18n.t(keys, vars);
  }

  /**
   * The context in which the application runs
   *
   * @public
   * @readonly
   * @type {Context}
   */
  get context() {
    return this.props.context;
  }

  log = (...args) => {
    console.log.apply(console, args);
  };
}

export default AppClient;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
